<!DOCTYPE html>
<html>

<head>



    <title>Event - Troop 485</title>

    <script src="/js/combined.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.9.0/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyAvhRMDTAxHRqIM0-RpHxPjZtMn7S_H7K4",
            authDomain: "t485.firebaseapp.com",
            databaseURL: "https://t485.firebaseio.com",
            storageBucket: "project-2556333409340273878.appspot.com",
            messagingSenderId: "510743665020"
        };
        firebase.initializeApp(config);
    </script>
    <script src="/js/t485.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/t485.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Josefin+Slab:100,300,400,600,700,100italic,300italic,400italic,600italic,700italic">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Join Troop 485 in Cupertino to experience an excellent Scouting experience">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <meta name="google-signin-client_id" content="154157170484-81ud6v3rfber96pekq75q86igmf1fsif.apps.googleusercontent.com">

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">

    <link rel="manifest" href="/manifest.json">

    <script>
        try {
            localStorage.setItem('foo', 'bar');
        }
        catch (e) {
            if (e.message === 'The quota has been exceeded.') {
                // using Safari(desktop & iOS) or Chrome(iOS) w/ private, localStorage not supported
                // firebase will throw error, so better to alert user now
                alert('Private browsing is not supported!');
            }
            throw '';
        }
    </script>
    <style>
        .hidden {
            display: none;
        }
        
        .print {
            display: none;
        }
        
        @media print {
            * {
                visibility: hidden;
            }
            #main {
                display: none;
            }
            .print,
            .print * {
                visibility: visible;
                display: block;
            }
        }
        
        #export-description {
            resize: vertical;
            /* user can resize vertically, but width is fixed */
        }
        
        #main-inner-box {
            word-wrap: break-word;
        }
    </style>
</head>

<body>
    <img src="/img/header.gif" id="header" alt="Troop 485 banner" width="990" height="151">
    <!-- Navigation -->
    <nav class="navbar navbar-default">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
                <!-- navbar-brand is hidden on larger screens, but visible when the menu is collapsed -->
                <a class="navbar-brand" href="/">T485</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    <li>
                        <a href="/calendar.html">Calendar</a>
                    </li>
                    <li>
                        <a href="/directory.html">Directory </a>
                    </li>

                    <li>
                        <a href="/new-scout.html">New Scouts</a>
                    </li>

                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                        Resources <span class="caret"></span>
                    </a>
                        <ul class="dropdown-menu">
                            <li><a href="/resources/files.html">Files</a></li>
                            <li><a href="/resources/event-pages.html">Event Pages</a></li>
                            <li><a href="/resources/meeting-minutes.html">Meeting Minutes/Reflections</a></li>
                            <li><a href="/resources/pictures.html">Pictures</a></li>
                            <li><a href="/resources/app-download.html">Download App</a></li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                        About <span class="caret"></span>
                    </a>
                        <ul class="dropdown-menu">
                            <li><a href="/about/faq.html">FAQ</a></li>
                            <li><a href="/about/merit-badges.html">Merit Badges</a></li>
                            <li><a href="/about/eagle.html">Path to Eagle</a></li>
                            <li><a href="/about/smc.html">SMC &amp; BOR</a></li>
                            <li><a href="/about/plc.html">PLC</a></li>
                            <li><a href="/about/troop-info.html">Troop Information</a></li>
                            <li><a href="/about/troop-jobs.html">Troop Jobs</a></li>
                        </ul>
                    </li>
                    <li id="nav-user-status"><a onclick="window.location.href = '/logout.html?redir=' + encodeURIComponent(window.location.pathname);">Logout</a></li>

                </ul>

            </div>
        </div>
    </nav>
    <div id="alertBox"></div>
    <div class="alert alert-info alert-dismissible alert-visible hidden" role="alert" id="edit-alert-box">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <span id="edit-alert">You <span id="role-owner" class="hidden">are the owner of</span><span id="role-editor" class="hidden">are using an access link for</span> this event page.<br> Options: <a id="edit" class="alert-link">edit</a> | <a id="export"
            class="alert-link">Export/Send</a> | <a id="share" class="hidden alert-link">Allow others to edit this page.</a>
        <!--DONT WANT THEM TO DELETE EVENT PAGES. I WANT THEM TO KEEP IT FOR ARCHIVAL REASONS<a id="delete" class="hidden alert-link"> Delete this page.</a>--></span>
    </div>

    </div>
    </p>
    <p id="loading">Loading...</p>
    <div class="container hidden" id="login">

        <div class="row">
            <div class="box col-xs-12">
                <hr>
                <h2 class="intro-text text-center">Login to continue</h2>
                <hr>
                <p>
                    <a class="btn btn-block btn-social btn-google no-fancy-link" onclick="window.location.href = '/login.html?redir=' + encodeURIComponent(window.location.pathname)">
                        <span class="fa fa-google"></span> Sign in with Google
                    </a>
                </p>
            </div>
        </div>
    </div>
    <div class="container hidden" id="content">
        <div class="print col-lg-12" id="print">
            <h2 class="text-center event-title">Loading...</h2>
            <hr>
            <p class="event-description">Loading...</p>
            <br>
            <br>
            <br>
            <hr>
            <p>Read more at the event page:<span id="print-url"></span></p>
        </div>
        <div class="row" id="main">
            <div class="box" id="main-inner-box">
                <div class="col-lg-12">
                    <hr>
                    <h2 class="intro-text text-center editable" id="event-title">Loading...</h2>
                    <hr>
                </div>
                <div class="col-md-12" id="event-description-box">
                    <div class="editable" id="event-description">Loading...</div>

                </div>

                <div class="clearfix"></div>
            </div>
        </div>

        <script src="https://static.getclicky.com/js"></script>
        <script>
            try {
                clicky.init(100869133)
            }
            catch (e) {}
        </script>
        <noscript><p><img alt="Clicky" width="1" height="1" src="https://in.getclicky.com/100869133ns.gif"></p></noscript>

    </div>
    <!-- /.container -->
    <footer>
        <div class="container">
            <div class="box">
                <div class="col-lg-12 text-center">
                    <p>Copyright &copy; 2006-2017 Troop 485, Silicon Valley Monterey Bay Council, Boy Scouts of America.</p>

                </div>
            </div>
        </div>
    </footer>

    <script src="/js/tinymce/tinymce.min.js"></script>
    <script src="/js/jspdf.min.js"></script>
    <script src="/js/printthis.js"></script>
    <!--authentication checkpoint -->
    <script>
        $("#loading").addClass("hidden");
        auth(() => $("#content").removeClass("hidden"), () => $("#login").removeClass("hidden"));
    </script>
    <script>
        /* global firebase $ getQuery tinymce btoa auth jsPDF*/
        function deleteLink(id) {
            console.log("deleting: " + id)
            firebase.database().ref('/events/' + getQuery("event") + "/editlinks/" + id).set(null);
            console.log("deleted: " + id)
            $("#links").html("");

            firebase.database().ref('/events/' + getQuery("event") + "/editlinks/").on("child_added", data => {

                console.log(data.val());
                console.log(data.key);

                $("#links").append("<li><b>https://t485.org/event.html?event=" + getQuery("event") + "&token=" + data.val() + "</b> (<a onclick='deleteLink(\"" + data.val() + "\")'>Remove This Link</a>)</li><hr>");
            });


        }
        $(".at").html("@");
        $(".event-page-url").html("https://t485.org/event.html?event=" + getQuery("event"));
        if (getQuery("event") === null || getQuery("event") === "") {
            window.location.href = "/files.html";
        }
        firebase.database().ref('/events/' + encodeURIComponent(getQuery("event"))
            /*URL is url safe anyways, this is to trigger the data = null 404
                    when the event contains non URL safe charcters*/
        ).once('value').then(snapshot => {
            let data = snapshot.val();
            if (data === null || data === 0) {
                $("#event-title").html("Error 404: Event Not Found");
                $("#event-description").html("The specified event <b>" + getQuery("event") + "</b> was not found. If you typed in a link to view this page, try going to the <a href='resources/event-pages.html'>event pages list</a> and clicking a link from there.");
                $(".event-title").html("Error 404: Event Not Found");
                $(".event-description").html("The specified event <b>" + getQuery("event") + "</b> was not found. If you typed in a link to view this page, try going to the <a href='resources/event-pages.html'>event pages list</a> and clicking a link from there.");


            }
            else {
                $("#event-title").html(data.title);
                $("#event-description").html(data.description);
                $(".event-title").html(data.title);
                $(".event-description").html(data.description);

                $("#print-url").html("<a href='" + "https://t485.org/event.html?event=" + getQuery("event") + "'>" + "https://t485.org/event.html?event=" + getQuery("event") + "</a>");
                main();
            }

        });

        function main() {
            /*
            var modalreg = /^https?:\/\/((docs\.google\.com\/document\/d.*)|(.+\.pdf([?#].*)?))$/;
            $("#event-description a").each(function(i) {
                console.log("ASDF213");
                console.log(i);
                console.log($(this));
                if ($(this).attr("href").match(modalreg)) {
                    console.log($(this).attr("href"));
                    console.log($(this).attr("href").replace(modalreg, "openModal(this, '" + $(this).attr("href") + "');"));
                    var attrtxt = $(this).attr("href").replace(modalreg, "openModal(this, '" + $(this).attr("href") + "');");
                    console.log("---");
                    console.log(attrtxt);
                    $(this).attr("onclick", attrtxt);
                    $(this).attr("href", null);
                    console.log($(this).attr("href"));

                }
            });
            */
            /*
            console.log(7)
            $("#event-description a").each(function(i, el) {
                console.log(i);
                var url = $(el).attr("href");
                var html = $(el).html()
                console.log(url);
                console.log(html);
                console.log($(el));
                console.log("a")
                var modalreg = /^https?:\/\/((docs\.google\.com\/document\/d.*)|(.+\.pdf([?#].*)?))$/;
                if (url.match(modalreg)) {
                    console.log("b")
                    $(el).attr("onclick", "openModal('" + url + "', '" + html + "')");
                    console.log($(el).attr("onclick"))
                    console.log("c")
                    $(el).attr("href", null);
                    console.log($(el).attr("href"))
                    console.log("d")
                    el.setAttribute("onclick", "openModal('" + url + "', '" + html + "')");
                
                }

            });
            */
            /*
            function forEachElement(selector, fn) {
                var elements = document.querySelectorAll(selector);
                for (var i = 0; i < elements.length; i++)
                    fn(elements[i], i);
            }

            forEachElement("#event-description a", function(el, i) {
                console.log(i);
                var url = el.getAttribute("href");
                var html = el.innerHTML;
                console.log(url);
                console.log(html);
                console.log(el);
                console.log("a");
                var modalreg = /^https?:\/\/((docs\.google\.com\/document\/d.*)|(.+\.pdf([?#].*)?))$/;
                if (url.match(modalreg)) {
                    console.log("b");
                    el.setAttribute("onclick", "openModal('" + url + "', '" + html + "')");
                    console.log($(el).attr("onclick"));
                    console.log("c");
                    el.setAttribute("href", undefined);
                    console.log(el.getAttribute("href"));
                    console.log("d");

                }
            });
            */
            if (getQuery("password") !== null) {
                firebase.database().ref('/events/' + getQuery("event") + "/editlinks/").once('value').then(function(snapshot) {


                    if (snapshot.val() === encodeURIComponent(getQuery("token"))) {
                        $("#role-editor").removeClass("hidden")
                        $("#edit-alert-box").removeClass("hidden");
                        $("#edit").click(() => {
                            $(window).on("beforeunload", function() {
                                return 'Changes you made may not be saved';
                            });
                            $("#edit-alert").html("Click on some text to edit it. After you edit some text, click save changes on the toolbar that pops up. This will save the text only on the paragraph you selected. Or <a id='view' class='alert-link'>View this page</a>.");
                            $("#view").click(() => {

                                window.location.href = window.location.href;
                            });

                            function modalURLConverter(url, node, on_save, name) {
                                var modalreg = /^https?:\/\/((docs\.google\.com\/document\/d.*)|(.+\.pdf([?#].*)?))$/;
                                url = tinymce.convertURL(url)
                                if (url.match(modalreg)) {
                                    return "javascript:openModal(this, '" + url + "');";
                                }
                                else {
                                    return url;
                                }



                            }

                            tinymce.init({
                                selector: "#event-title", //'h2.editable',

                                inline: true,
                                plugins: [
                                    "textcolor colorpicker link"
                                ],
                                toolbar: "undo redo | forecolor backcolor | link | save",
                                menubar: false,
                                setup: editor => {
                                    editor.addButton("save", {
                                        text: "Save Changes",
                                        icon: false,
                                        onclick: () => {
                                            console.log(editor.getContent());
                                            console.log(editor.id);
                                            firebase.database().ref("/events/" + getQuery("event") + "/" + editor.id.replace("event-", "") + "/").set(editor.getContent());
                                        }
                                    });
                                }
                            });

                            tinymce.init({
                                selector: "#event-description", //'div.editable',
                                //urlconverter_callback: 'modalURLConverter',
                                inline: true,
                                plugins: [
                                    "advlist autolink lists link image charmap print preview",
                                    "searchreplace visualblocks fullscreen textcolor colorpicker",
                                    "insertdatetime media table contextmenu paste imagetools"
                                ],
                                link_assume_external_targets: true,
                                removed_menuitems: "newdocument",
                                setup: editor => {
                                    editor.addButton("save", {
                                        text: "Save Changes",
                                        icon: false,
                                        onclick: () => {
                                            console.log(editor.getContent());
                                            console.log(editor.id);
                                            firebase.database().ref("/events/" + getQuery("event") + "/" + editor.id.replace("event-", "") + "/").set(editor.getContent());
                                        }
                                    });
                                },
                                toolbar: "insertfile undo redo | styleselect | bold italic | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | save"
                            });

                        });

                    }
                });
            }

            function generateRandomStr() {
                let text = "";
                let possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_-+={}[]|?/>.<,";

                Array(40).fill(0).forEach(() => {
                    text += possible.charAt(Math.floor(Math.random() * possible.length));
                });

                return encodeURIComponent(btoa(text));
            }


            firebase.database().ref('/events/' + getQuery("event")).once('value').then(snapshot => {
                let data = snapshot.val();

                $("#event-title").html(data.title);
                $("#event-description").html(data.description);

            });


            auth(user => {
                firebase.database().ref('/events/' + getQuery("event")).once('value').then(snapshot => {
                    let uid = snapshot.val().owner;
                    if (uid === user.uid) {
                        $("#role-owner").removeClass("hidden")
                        $("#edit-alert-box").removeClass("hidden");
                        $("#share").removeClass("hidden");
                        $("#delete").removeClass("hidden");




                        $("#delete").click(() => {
                            $("#confirm-delete").modal("show");
                            $("#confirm-enter-name").keyup(() => {
                                if (($("#confirm-enter-name").val().toLowerCase() === snapshot.val().title.toLowerCase()) && getQuery("event") !== null) {
                                    $("#confirm-delete-button").removeClass("disabled");
                                    $("#confirm-delete-button").on("click", () => {
                                        firebase.database().ref('/events/' + getQuery("event")).set(null);
                                        $("#confirm-delete").modal("hide");
                                        window.location.href = "resources/event-pages.html";
                                    });
                                }
                                else {
                                    $("#confirm-delete-button").addClass("disabled");
                                    $("#confirm-delete-button").off("click");
                                }
                            });

                        });
                        $("#share").click(() => {
                            $("#links").html("");

                            firebase.database().ref('/events/' + getQuery("event") + "/editlinks/").on("value", function(snapshot) {

                                var data = snapshot.val()

                                for (var key in data) {
                                    if (data.hasOwnProperty(key)) {
                                        console.log(key + " -> " + data[key]);
                                        $("#links").append("<li><b>https://t485.org/event.html?event=" + getQuery("event") + "&token=" + data[key] + "</b> (<a onclick='deleteLink(\"" + data[key] + "\")'>Remove This Link</a>)</li><hr>");
                                    }
                                }

                            });
                            $("#share-modal").modal("show");

                        });


                        $("#new-access-link").click(() => {
                            let id = generateRandomStr();
                            firebase.database().ref('/events/' + getQuery("event") + "/editlinks/" + id).set(id);

                        });
                        $("#edit").click(() => {
                            $(window).on("beforeunload", function() {
                                return 'Changes you made may not be saved';
                            });
                            $("#edit-alert").html("Click on some text to edit it. After you edit some text, click save changes on the toolbar that pops up. This will save the text only on the paragraph you selected. Or <a id='view' class='alert-link'>View this page</a>.");
                            $("#view").click(() => {
                                reloadPage();
                            });
                            tinymce.init({
                                selector: "#event-title", //'h2.editable',
                                inline: true,
                                plugins: [
                                    "textcolor colorpicker link"
                                ],
                                toolbar: "undo redo | forecolor backcolor | link | save",
                                menubar: false,
                                setup: editor => {
                                    editor.addButton("save", {
                                        text: "Save Changes",
                                        icon: false,
                                        onclick: () => {
                                            console.log(editor.getContent());
                                            console.log(editor.id);
                                            firebase.database().ref("/events/" + getQuery("event") + "/" + editor.id.replace("event-", "") + "/").set(editor.getContent());
                                        }
                                    });
                                }
                            });

                            tinymce.init({
                                selector: "#event-description", //'div.editable',
                                inline: true,
                                //urlconverter_callback: 'modalURLConverter',
                                plugins: [
                                    "advlist autolink lists link image charmap print preview",
                                    "searchreplace visualblocks fullscreen textcolor colorpicker",
                                    "insertdatetime media table contextmenu paste imagetools"
                                ],
                                link_assume_external_targets: true,
                                removed_menuitems: "newdocument",
                                setup: editor => {
                                    editor.addButton("save", {
                                        text: "Save Changes",
                                        icon: false,
                                        onclick: () => {
                                            console.log(editor.getContent());
                                            console.log(editor.id);
                                            firebase.database().ref("/events/" + getQuery("event") + "/" + editor.id.replace("event-", "") + "/").set(editor.getContent());
                                        }
                                    });
                                },
                                toolbar: "insertfile undo redo | styleselect | bold italic | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | save"
                            });


                        });
                    }

                });

                function getFirebaseDataThen(callback, requireDescription) {
                    firebase.database().ref('/events/' + getQuery("event")).once('value').then(snapshot => {
                        let data = snapshot.val();

                        if (data !== null) {
                            if ($("#export-description").val().replace(" ", "") === "" && requireDescription !== false) {
                                alert("You must write a description. (You can just copy/paste from the event page. Note links and formatting will be removed)");
                            }
                            else {
                                let text = $("#export-description").val() + "\n --- \n Read more at the event page: https://t485.org/event.html?event=" + getQuery("event");
                                callback(data.title, text, "https://t485.org/event.html?event=" + getQuery("event"), data.description);
                            }

                        }
                        else {
                            // alert("Unknown error occured. Please try again or notify the webmaster.", "https://t485.org/event.html?event=" + getQuery("event"));
                        }
                    });
                }
                $("#export-slack").click(() => {

                    getFirebaseDataThen((title, text, url) => {
                        $.post("https://hooks.slack.com/services/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", "payload=" + JSON.stringify({
                                "text": "Event Page shared:",
                                "attachments": [{
                                    "fallback": "A event page was shared: <" + title + "|https://t485.org/event.html?event=" + url + ">.",
                                    "title": title,
                                    "title_link": url,
                                    "text": text,
                                    "footer": "This is a T485 event page automated message"
                                }]
                            }),
                            data => {
                                window.location.href = url;
                            }
                        );
                        $("#export-slack").html("Exported to slack - Export again");
                    });

                });
                $("#export-gmail").click(() => {
                    getFirebaseDataThen((title, text, url) => {
                        window.location.href = "https://mail.google.com/mail/?view=cm&fs=1&tf=1&su=" + encodeURIComponent(title) + "&body=" + encodeURIComponent(text);
                        $("export-modal").modal("hide");
                    });
                });
                $("#export-yahoo").click(() => {
                    getFirebaseDataThen((title, text, url) => {
                        window.location.href = "http://compose.mail.yahoo.com/?subject=" + encodeURIComponent(title) + "&body=" + encodeURIComponent(text);
                        $("export-modal").modal("hide");
                    });
                });
                $("#export-hotmail").click(() => {
                    getFirebaseDataThen((title, text, url) => {
                        window.location.href = "https://dub130.mail.live.com/default.aspx?rru=compose&subject=" + encodeURIComponent(title) + "&body=" + encodeURIComponent(text) + "#page=Compose";
                        $("export-modal").modal("hide");
                    });
                });
                $("#export-aol").click(() => {
                    getFirebaseDataThen((title, text, url) => {
                        window.location.href = "http://webmail.aol.com/Mail/ComposeMessage.aspx?subject=" + encodeURIComponent(title) + "&body=" + encodeURIComponent(text);
                        $("export-modal").modal("hide");

                    });
                });
                $("#export-email").click(() => {
                    getFirebaseDataThen((title, text, url) => {
                        window.location.href = "mailto:?Subject=" + encodeURIComponent(title) + "&Body=" + encodeURIComponent(text);
                        $("export-modal").modal("hide");
                    });
                });
                $("#export-pdf").click(() => {
                    getFirebaseDataThen((title, text, url) => {
                        let doc = new jsPDF();
                        let specialElementHandlers = {
                            '#editor': (element, renderer) => {
                                return true;
                            }
                        };


                        doc.fromHTML($('#print').html(), 15, 15, {
                            'width': 170,
                            'elementHandlers': specialElementHandlers
                        });
                        doc.save(title + '.pdf');

                        $("export-modal").modal("hide");
                    });

                });
                getFirebaseDataThen((title, text, url, realtext) => {
                    $("#export-html").attr("href", "data:text/html,<html><head></head><body><h1>" + title + "</h1><div>" + realtext + "</div><br><br><br><hr><p>Read more at the <a href='" + url + "'>event page</a>.</p></body></html>");
                    $("#export-html").attr("download", title + ".html");
                }, false);



                $("#export-print").click(() => {
                    console.log(1);
                    getFirebaseDataThen((title, text, url) => {
                        console.log(2);
                        $("#print").printThis();

                    }, false);
                });

                $("#export").click(() => {
                    $("#export-modal").modal("show");
                });

            }, () => {
                //somthing should have already happened
                //window.location.href = 'login.html?redir=event.html' + encodeURIComponent(window.location.search);
            });
        }

        /*function modalURLConverter(url, node, on_save, name) {
            console.log(node);
            console.log(name);
            var modalreg = /^https?:\/\/((docs\.google\.com\/document\/d.*)|(.+\.pdf([?#].*)?))$/;
            if (url.match(modalreg)) {
                return "javascript:openModal('" + url + "');";
            }
            else {
                return url;
            }



        }*/


        function openModal(url, name) {

            $('#ifr').attr('src', url);
            $('#mdlk').attr('href', url.replace("/mobilebasic", "/edit"));
            $("#document-view-label").html(name)
            $('#document-view').modal('show');
        }

        function requestFullScreen() {
            let el = document.getElementById("ifr");
            // Supports most browsers and their versions.
            let requestMethod = el.requestFullScreen || el.webkitRequestFullScreen || el.mozRequestFullScreen || el.msRequestFullScreen;

            if (requestMethod) {
                requestMethod.call(el);
                // Older IE.
            }
            else if (typeof window.ActiveXObject !== "undefined") {
                let wscript = new ActiveXObject("WScript.Shell");

                if (wscript !== null) {
                    wscript.SendKeys("{F11}");
                }
            }
        }

        function reloadPage() {
            window.location.href = window.location.pathname + window.location.search + window.location.hash;
        }
    </script>

    <!-- Modal -->
    <div class="modal fade" id="share-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Allow other users to edit this page.</h4>
                </div>
                <div class="modal-body col-lg-12">
                    <p>Modify access links: Here you can create new edit links and also delete links. Only you can change access links.</p>
                    <ul id="links">

                    </ul>
                    <button class="btn btn-success" id="new-access-link">New Access Link</button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="export-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Export or Send this page</h4>
                </div>
                <div class="modal-body col-lg-12">

                    <h3>Choose a export method:</h3>
                    <p>
                        The url of your event page is: <b class="event-page-url"></b>
                        <br> To export to the T485 google group, choose any email export and enter send it to the T485 google groups. <b>t485<span class="at"> [a t ]] </span>googlegroups.com</b> as the recipient.
                        <hr>
                        <b>Enter a description of the event(Required for all options except for download and print. Ignored for download and print. This will be exported):</b>
                        <textarea id="export-description" class="form-control"></textarea>
                        <a id="export-email">Email - Mail App/Defualt mail handler</a><br>
                        <a id="export-gmail">Email - Gmail</a><br>
                        <a id="export-yahoo">Email - Yahoo</a><br>
                        <a id="export-hotmail">Email - Hotmail</a><br>
                        <a id="export-aol">Email - AOL</a><br>
                        <a id="export-slack">Slack</a><br>

                        <a id="export-pdf">Download - PDF</a><br>
                        <a id="export-html">Download - Offline Webpage(HTML)</a><br>
                        <a id="export-print">Print</a><br>

                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" onclick="window.location.hash = '';" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="modal-title">Please Confirm</h4>
                </div>
                <div class="modal-body" id="modal-body">
                    <h6>Dangrous Things will happen if you don't pay attention!</h6>
                    <p class="test-danger">You are about to delete a event page. In order to proceed, please type in the name of the event page you are trying to delete.</p>
                    <input class="form-control" type="text" id="confirm-enter-name">
                    <button class="form-control btn btn-danger disabled" id="confirm-delete-button">Delete</button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" onclick="window.location.hash = '';" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal -->
    <div aria-hidden="true" aria-labelledby="document-view-label" class="modal fade" id="document-view" role="dialog" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button aria-hidden="true" class="close" data-dismiss="modal" type="button">&times;</button>
                    <h4 class="modal-title" id="document-view-label">Document Viewer</h4>
                </div>

                <div class="modal-body">
                    <iframe frameborder="0" height="90%" id="ifr" name="ifr" src="" width="90%">Unfortunately, this content is unavaliable at this time. Please give feedback for this bug, and view the document on your google drive.</iframe>
                </div>

                <div class="modal-footer">
                    <a class="btn btn-primary" href="" id="mdlk" target="_blank" type="button">Open in new tab</a>
                    <button class="btn btn-primary" onclick="requestFullScreen();">Fullscreen mode</button>
                    <button class="btn btn-default" data-dismiss="modal" type="button">Close</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
</body>
